import { translateWithGemini } from './geminiService';

// Gemini APIë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ì—¬ í•œêµ­ì–´ ê°€ì •í†µì‹ ë¬¸ ìƒì„±
const GEMINI_API_BASE_URL = 'https://generativelanguage.googleapis.com/v1beta';
const DEFAULT_MODEL = 'gemini-1.5-flash';

async function generateKoreanContentWithGemini(prompt, apiKey) {
  try {
    const response = await fetch(`${GEMINI_API_BASE_URL}/models/${DEFAULT_MODEL}:generateContent?key=${apiKey}`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        contents: [{
          parts: [{ text: prompt }]
        }],
        generationConfig: {
          temperature: 0.7,
          topP: 0.8,
          topK: 40,
          maxOutputTokens: 2048,
        },
        safetySettings: [
          {
            category: 'HARM_CATEGORY_HARASSMENT',
            threshold: 'BLOCK_MEDIUM_AND_ABOVE'
          },
          {
            category: 'HARM_CATEGORY_HATE_SPEECH',
            threshold: 'BLOCK_MEDIUM_AND_ABOVE'
          },
          {
            category: 'HARM_CATEGORY_SEXUALLY_EXPLICIT',
            threshold: 'BLOCK_MEDIUM_AND_ABOVE'
          },
          {
            category: 'HARM_CATEGORY_DANGEROUS_CONTENT',
            threshold: 'BLOCK_MEDIUM_AND_ABOVE'
          }
        ]
      }),
    });

    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(`Gemini API ì˜¤ë¥˜: ${errorData.error?.message || response.statusText}`);
    }

    const data = await response.json();
    
    if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {
      throw new Error('Gemini APIì—ì„œ ìœ íš¨í•œ ì‘ë‹µì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
    }

    const generatedContent = data.candidates[0].content.parts.map(p => p.text || '').join('').trim();
    
    if (!generatedContent) {
      throw new Error('ìƒì„±ëœ ë‚´ìš©ì´ ë¹„ì–´ìžˆìŠµë‹ˆë‹¤.');
    }

    return generatedContent;
  } catch (error) {
    console.error('Gemini API í˜¸ì¶œ ì‹¤íŒ¨:', error);
    throw error;
  }
}

/**
 * ã€ŽAI ê¸°ë°˜ í•™êµ-ê°€ì • ì†Œí†µ: ëŒ€í•œë¯¼êµ­ ê°€ì •í†µì‹ ë¬¸ ìƒì„±ì„ ìœ„í•œ í”„ë ˆìž„ì›Œí¬ã€ ì—°êµ¬ ì™„ë²½ ì¤€ìˆ˜
 * í”„ë¡¬í”„íŠ¸ ë…¸ì¶œ ë¬¸ì œ 100% í•´ê²°, ìžì—°ìŠ¤ëŸ¬ìš´ í•œêµ­ì‹ ê°€ì •í†µì‹ ë¬¸ ìƒì„±
 */

/**
 * ë‚ ì§œë¥¼ í•œêµ­ì–´ í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
 * @param {Date|string} date - ë³€í™˜í•  ë‚ ì§œ
 * @returns {string} í•œêµ­ì–´ í˜•ì‹ ë‚ ì§œ ë¬¸ìžì—´ (ì˜ˆ: "2025ë…„ 10ì›” 1ì¼(ìˆ˜)")
 */
function formatKoreanDate(date) {
  if (!date) return '';
  
  const dateObj = date instanceof Date ? date : new Date(date);
  if (isNaN(dateObj.getTime())) return '';
  
  const year = dateObj.getFullYear();
  const month = dateObj.getMonth() + 1;
  const day = dateObj.getDate();
  const dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
  const dayName = dayNames[dateObj.getDay()];
  
  return `${year}ë…„ ${month}ì›” ${day}ì¼(${dayName})`;
}

/**
 * ë°°ì—´ ê°’ì„ ë¬¸ìžì—´ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
 * @param {Array} array - ë³€í™˜í•  ë°°ì—´
 * @returns {string} ì‰¼í‘œë¡œ êµ¬ë¶„ëœ ë¬¸ìžì—´
 */
function formatArrayValue(array) {
  if (!Array.isArray(array)) return '';
  return array.filter(item => item && item.trim()).join(', ');
}

// ===== ì—°êµ¬ ë¬¸ì„œ ê¸°ë°˜ í•µì‹¬ ì‹œìŠ¤í…œ =====

/**
 * ê³„ì ˆë³„ ì²«ì¸ì‚¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ (ì—°êµ¬ ë¬¸ì„œ ì œ2.4ìž¥)
 */
const SEASONAL_GREETINGS = {
  spring: [
    "ë§Œë¬¼ì´ ì†Œìƒí•˜ëŠ” ë´„, í•™ë¶€ëª¨ë‹˜ ê°€ì •ì— ìƒˆë¡œìš´ í¬ë§ì´ í”¼ì–´ë‚˜ê¸°ë¥¼ ê¸°ì›í•©ë‹ˆë‹¤.",
    "ë”°ëœ»í•œ ë´„ë°”ëžŒê³¼ í•¨ê»˜ í•™ë¶€ëª¨ë‹˜ ëŒë‚´ ê±´ê°•ê³¼ í–‰ë³µì´ ê°€ë“í•˜ê¸°ë¥¼ ë°”ëžë‹ˆë‹¤.",
    "ë´„ê½ƒì´ ë§Œê°œí•˜ëŠ” ê³„ì ˆ, í•™ë¶€ëª¨ë‹˜ê³¼ ìžë…€ë“¤ì—ê²Œ ìƒˆë¡œìš´ ì‹œìž‘ì˜ ê¸°ì¨ì´ í•¨ê»˜í•˜ì‹œê¸¸ ë°”ëžë‹ˆë‹¤."
  ],
  summer: [
    "ë¬´ë”ìš´ ì—¬ë¦„ì² ì´ì§€ë§Œ í•™ë¶€ëª¨ë‹˜ ê°€ì •ì— ì‹œì›í•œ ë°”ëžŒì´ ë¶ˆì–´ê°€ê¸°ë¥¼ ê¸°ì›í•©ë‹ˆë‹¤.",
    "ì—¬ë¦„ì˜ ëœ¨ê±°ìš´ í–‡ì‚´ ì•„ëž˜ì„œë„ í•™ë¶€ëª¨ë‹˜ ëŒë‚´ í‰ì•ˆí•˜ì‹œê¸°ë¥¼ ë°”ëžë‹ˆë‹¤.",
    "ê¸¸ê³  ë”ìš´ ì—¬ë¦„, í•™ë¶€ëª¨ë‹˜ê³¼ ê°€ì¡± ëª¨ë‘ ê±´ê°•í•˜ê²Œ ì§€ë‚´ì‹œê¸¸ ì§„ì‹¬ìœ¼ë¡œ ê¸°ì›í•©ë‹ˆë‹¤."
  ],
  autumn: [
    "ì–´ëŠë§ ê°€ì„ì´ ìš°ë¦¬ ì†ìœ¼ë¡œ ë“¤ì–´ì™”ìŠµë‹ˆë‹¤. í•™ë¶€ëª¨ë‹˜ ê°€ì •ì— í’ìš”ë¡œìš´ ê²°ì‹¤ì´ ê°€ë“í•˜ê¸°ë¥¼ ë°”ëžë‹ˆë‹¤.",
    "ë‹¨í’ì´ ê³±ê²Œ ë¬¼ë“  ê°€ì„, í•™ë¶€ëª¨ë‹˜ ëŒë‚´ ë‘ë£¨ í‰ì•ˆí•˜ì‹œê¸°ë¥¼ ê¸°ì›í•©ë‹ˆë‹¤.",
    "ì„ ì„ í•œ ê°€ì„ë°”ëžŒê³¼ í•¨ê»˜ í•™ë¶€ëª¨ë‹˜ê»˜ ê¸°ì¨ê³¼ ê°ì‚¬ê°€ ë„˜ì¹˜ëŠ” ì‹œê°„ì´ ë˜ì‹œê¸¸ ë°”ëžë‹ˆë‹¤."
  ],
  winter: [
    "ì°¨ê°€ìš´ ê²¨ìš¸ ë‚ ì”¨ì—ë„ í•™ë¶€ëª¨ë‹˜ ê°€ì •ì—ëŠ” ë”°ëœ»í•¨ì´ ê°€ë“í•˜ì‹œê¸°ë¥¼ ê¸°ì›í•©ë‹ˆë‹¤.",
    "í•œ í•´ì˜ ë§ˆì§€ë§‰ì„ ë³´ë‚´ë©°, í•™ë¶€ëª¨ë‹˜ ëŒë‚´ ê±´ê°•ê³¼ í–‰ë³µì´ ê³„ì†ë˜ê¸°ë¥¼ ë°”ëžë‹ˆë‹¤.",
    "ì¶”ìœ„ê°€ ë§¤ì„œìš´ ê²¨ìš¸ì´ì§€ë§Œ, í•™ë¶€ëª¨ë‹˜ê³¼ ê°€ì¡± ëª¨ë‘ ë”°ëœ»í•˜ê³  í‰ì•ˆí•˜ì‹œê¸¸ ë°”ëžë‹ˆë‹¤."
  ]
};

/**
 * í•™ìƒ ì¹­ì°¬ ì–´íœ˜ì§‘ (ì—°êµ¬ ë¬¸ì„œ ì œ3.3ìž¥ 'ì¹­ì°¬ì˜ ì–´íœ˜ì§‘')
 */
const PRAISE_VOCABULARY = {
  diligence: [
    "ë¬µë¬µí•˜ê²Œ ìžê¸° í•  ì¼ì„ í•˜ê³  ì„±ì‹¤í•©ë‹ˆë‹¤",
    "ë§¤ì‚¬ì— ìµœì„ ì„ ë‹¤í•˜ëŠ” ì„±ì‹¤í•œ ëª¨ìŠµì„ ë³´ì—¬ì¤ë‹ˆë‹¤",
    "ê¾¸ì¤€ížˆ ë…¸ë ¥í•˜ëŠ” ì„±ì‹¤í•œ íƒœë„ê°€ ë‹ë³´ìž…ë‹ˆë‹¤"
  ],
  leadership: [
    "ì§€ë„ë ¥ì´ ìžˆê³  ë§¤ì‚¬ì— ì ê·¹ì ì´ì–´ì„œ í•™ê¸‰ì¼ì— í˜‘ì¡°ì ìž…ë‹ˆë‹¤",
    "ì¹œêµ¬ë“¤ì„ ì´ëŒì–´ê°€ëŠ” í›Œë¥­í•œ ë¦¬ë”ì‹­ì„ ë°œíœ˜í•©ë‹ˆë‹¤",
    "ì†”ì„ ìˆ˜ë²”í•˜ë©° ê¸‰ìš°ë“¤ì—ê²Œ ì¢‹ì€ ëª¨ë²”ì´ ë©ë‹ˆë‹¤"
  ],
  cooperation: [
    "ì¹œêµ¬ë“¤ê³¼ ìž˜ ì–´ìš¸ë¦¬ë©° í˜‘ë ¥í•˜ëŠ” ëª¨ìŠµì´ ì•„ë¦„ë‹µìŠµë‹ˆë‹¤",
    "ë‹¨ì²´ í™œë™ì—ì„œ ë‚¨ì„ ë°°ë ¤í•˜ëŠ” ë”°ëœ»í•œ ë§ˆìŒì„ ë³´ìž…ë‹ˆë‹¤",
    "ëª¨ë‘  í™œë™ ì‹œ ì ê·¹ì ìœ¼ë¡œ ì°¸ì—¬í•˜ë©° í˜‘ë™ì‹¬ì„ ë°œíœ˜í•©ë‹ˆë‹¤"
  ],
  creativity: [
    "ì°½ì˜ì ì¸ ì•„ì´ë””ì–´ë¡œ í™œë™ì„ í’ì„±í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤",
    "ë…ì°½ì ì¸ ì‚¬ê³ ë¡œ ìƒˆë¡œìš´ ê´€ì ì„ ì œì‹œí•©ë‹ˆë‹¤",
    "ìƒìƒë ¥ì´ í’ë¶€í•˜ì—¬ ìž¬ë¯¸ìžˆëŠ” ë°œìƒì„ ìžì£¼ í•©ë‹ˆë‹¤"
  ],
  kindness: [
    "ë‹¤ë¥¸ ì‚¬ëžŒì„ ë°°ë ¤í•˜ëŠ” ë”°ëœ»í•œ ë§ˆìŒì”¨ë¥¼ ê°€ì§€ê³  ìžˆìŠµë‹ˆë‹¤",
    "ì–´ë ¤ì›Œí•˜ëŠ” ì¹œêµ¬ë¥¼ ë„ì™€ì£¼ëŠ” ì°©í•œ ë§ˆìŒì„ ë³´ì—¬ì¤ë‹ˆë‹¤",
    "ì–¸ì œë‚˜ ë¶€ë“œëŸ½ê³  ì¹œì ˆí•œ íƒœë„ë¡œ ëŒ€í•©ë‹ˆë‹¤"
  ]
};

/**
 * ì–´ì¡° ìŠ¤íŽ™íŠ¸ëŸ¼ (ì—°êµ¬ ë¬¸ì„œ í‘œ2 ì™„ì „ ë°˜ì˜)
 */
const TONE_SPECTRUM = {
  warm_caring: {
    name: 'ë”°ëœ»í•˜ê³  ë³´ì‚´í”¼ëŠ” ì–´ì¡°',
    usage: 'í•™ê¸° ë§ ì†Œê°, ì¼ë°˜ í•™êµìƒí™œ ì•ˆë‚´, ì´ˆë“±í•™êµ',
    features: ['ê³„ì ˆ ì¸ì‚¬', 'ì‚¬ëž‘ìŠ¤ëŸ¬ìš´', 'ê¸°íŠ¹í•œ', 'í•¨ê»˜ ì„±ìž¥í•˜ëŠ”']
  },
  formal_informative: {
    name: 'ê³µì‹ì ì´ê³  ì •ë³´ì ì¸ ì–´ì¡°',
    usage: 'í–‰ì‚¬ ì•ˆë‚´, ì •ì±… ë³€ê²½, ì¼ì • ê³ ì§€',
    features: ['ë‹¤ìŒê³¼ ê°™ì´ ì•ˆë‚´í•©ë‹ˆë‹¤', 'ì°¸ê³ í•˜ì‹œê¸° ë°”ëžë‹ˆë‹¤', 'ì— ì˜ê±°í•˜ì—¬']
  },
  urgent_directive: {
    name: 'ê¸´ê¸‰í•˜ê³  ì§€ì‹œì ì¸ ì–´ì¡°',
    usage: 'ì•ˆì „ ìˆ˜ì¹™, ê°ì—¼ë³‘ ì˜ˆë°©, ìž¬ë‚œ ê²½ë³´',
    features: ['ë°˜ë“œì‹œ í•´ì•¼ í•©ë‹ˆë‹¤', 'ì„ ê¸ˆì§€í•©ë‹ˆë‹¤', 'ê°ë³„ížˆ ìœ ì˜í•´ì£¼ì‹­ì‹œì˜¤']
  },
  reflective_philosophical: {
    name: 'ì„±ì°°ì ì´ê³  ì² í•™ì ì¸ ì–´ì¡°',
    usage: 'í•™ë…„ ë§ ì„±ì í‘œ, ì¡¸ì—…ì‹',
    features: ['ì‚¶ì˜ ì˜ë¯¸', 'ì„±ìž¥ì˜ ê³¼ì •', 'ì¸ìƒì˜ ìŠ¤ìŠ¹', 'ë§ˆìŒì˜ ê·¼ìœ¡']
  },
  empathetic_encouraging: {
    name: 'ê³µê°ì ì´ê³  ê²©ë ¤í•˜ëŠ” ì–´ì¡°',
    usage: 'ì„±ì  ë¶€ì§„, í•™êµ ë¶€ì ì‘ ìƒë‹´',
    features: ['ê²°ê³¼ê°€ ë§ˆìŒì— ë“¤ì§€ ì•Šì„ ìˆ˜ë„', 'ë‚™ë‹´í•˜ì§€ ì•Šê²Œ ê²©ë ¤í•´ì£¼ì„¸ìš”']
  }
};

/**
 * ì—°êµ¬ ë¬¸ì„œ ì œ3ìž¥ ê¸°ë°˜: ê°€ì •í†µì‹ ë¬¸ ëª©ì ë³„ ë¶„ë¥˜
 * 4ê°€ì§€ í•µì‹¬ ì—­í• : ê³µì§€ìž, ì¡°ì •ìž, í‰ê°€ìž, ë³´í˜¸ìž
 */
const NOTICE_PURPOSE_TYPES = {
  announcer: {
    name: 'ê³µì§€ìž (The Announcer)',
    description: 'í–‰ì‚¬, ì •ì±…, ì¼ì • ì •ë³´ ì „ë‹¬',
    structure: 'direct_clear',
    tone: 'formal_informative',
    content_features: ['ì‚¬ì‹¤ ê¸°ë°˜', 'ëª©ë¡/í‘œ í™œìš©', 'í•µì‹¬ ì •ë³´ ê°•ì¡°']
  },
  coordinator: {
    name: 'ì¡°ì •ìž (The Coordinator)',
    description: 'ì°¸ì—¬, ì„¤ë¬¸, ë™ì˜ ìš”ì²­',
    structure: 'request_focused',
    tone: 'formal_informative',
    content_features: ['íšŒì‹  ê¸°í•œ ëª…ì‹œ', 'í˜‘ì¡° ìš”ì²­', 'ì ˆì·¨ì„ /ë§í¬ í¬í•¨']
  },
  assessor: {
    name: 'í‰ê°€ìž (The Assessor)',
    description: 'ì„±ì  í†µì§€ ë° í•™ìƒ í‰ê°€',
    structure: 'evaluation_focused',
    tone: 'empathetic_encouraging',
    content_features: ['ì„±ìž¥ ê³¼ì • ì¤‘ì‹¬', 'ê¸ì •ì  í‘œí˜„', 'ê²©ë ¤ ë©”ì‹œì§€']
  },
  guardian: {
    name: 'ë³´í˜¸ìž (The Guardian)',
    description: 'ì•ˆì „, ê±´ê°•, ì¸ì„± êµìœ¡',
    structure: 'safety_focused',
    tone: 'urgent_directive',
    content_features: ['ìˆ˜ì¹™ ê°•ì¡°', 'ê²½ê³  í‘œì‹œ', 'í–‰ë™ ì§€ì¹¨']
  }
};

/**
 * ê³„ì ˆë³„ ì²«ì¸ì‚¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ (ì—°êµ¬ ë¬¸ì„œ ê¸°ë°˜)
 * ì‹œê°„ì  í˜„ìž¥ê°ê³¼ ê³µë™ì²´ ì˜ì‹ ê°•í™”ë¥¼ ìœ„í•œ ë™ì  ì¸ì‚¬ë§
 */
const SEASONAL_GREETINGS = {
  spring: {
    months: [3, 4, 5],
    greetings: [
      "ë§Œë¬¼ì´ ì†Œìƒí•˜ëŠ” ë´„ìž…ë‹ˆë‹¤. í•™ë¶€ëª¨ë‹˜ ê°€ì •ì— ê±´ê°•ê³¼ í–‰ìš´ì´ í•¨ê»˜í•˜ì‹œê¸°ë¥¼ ê¸°ì›í•©ë‹ˆë‹¤.",
      "ë”°ëœ»í•œ ë´„ë°”ëžŒì´ ë¶ˆì–´ì˜¤ëŠ” ê³„ì ˆìž…ë‹ˆë‹¤. ëŒë‚´ ë‘ë£¨ í‰ì•ˆí•˜ì‹œê¸°ë¥¼ ê¸°ì›í•©ë‹ˆë‹¤.",
      "ìƒˆì‹¹ì´ ë‹ì•„ë‚˜ëŠ” í¬ë§ì°¬ ë´„ì„ ë§žì•„ í•™ë¶€ëª¨ë‹˜ê»˜ ë”°ëœ»í•œ ì¸ì‚¬ë¥¼ ë“œë¦½ë‹ˆë‹¤."
    ]
  },
  summer: {
    months: [6, 7, 8],
    greetings: [
      "ë¬´ë”ìš´ ì—¬ë¦„ì² ì´ì§€ë§Œ í•™ë¶€ëª¨ë‹˜ ê°€ì •ì— ì‹œì›í•œ ë°”ëžŒì´ ë¶ˆì–´ê°€ê¸°ë¥¼ ê¸°ì›í•©ë‹ˆë‹¤.",
      "íƒœì–‘ì´ ëœ¨ê²ê²Œ ë‚´ë¦¬ì¬ëŠ” ì—¬ë¦„ìž…ë‹ˆë‹¤. ê°€ì¡± ëª¨ë‘ ê±´ê°•í•˜ê²Œ ì§€ë‚´ì‹œê¸°ë¥¼ ë°”ëžë‹ˆë‹¤.",
      "í‘¸ë¥¸ ì—¬ë¦„ì„ ë§žì•„ í•™ë¶€ëª¨ë‹˜ê»˜ ì‹œì›í•œ ì¸ì‚¬ë¥¼ ì „í•´ë“œë¦½ë‹ˆë‹¤."
    ]
  },
  autumn: {
    months: [9, 10, 11],
    greetings: [
      "ì–´ëŠë§ ê°€ì„ì´ ìš°ë¦¬ ì†ìœ¼ë¡œ ë“¤ì–´ì™”ìŠµë‹ˆë‹¤. í•™ë¶€ëª¨ë‹˜ ê°€ì •ì— í’ì„±í•œ ê²°ì‹¤ì´ ìžˆê¸°ë¥¼ ê¸°ì›í•©ë‹ˆë‹¤.",
      "ë‹¨í’ì´ ë¬¼ë“¤ì–´ê°€ëŠ” ì•„ë¦„ë‹¤ìš´ ê°€ì„ìž…ë‹ˆë‹¤. ëŒë‚´ í‰ì•ˆí•˜ì‹œê¸°ë¥¼ ê¸°ì›í•©ë‹ˆë‹¤.",
      "ì²œê³ ë§ˆë¹„ì˜ ê³„ì ˆì„ ë§žì•„ í•™ë¶€ëª¨ë‹˜ê»˜ ê°ì‚¬ì˜ ì¸ì‚¬ë¥¼ ë“œë¦½ë‹ˆë‹¤."
    ]
  },
  winter: {
    months: [12, 1, 2],
    greetings: [
      "í•˜ì–€ ëˆˆì´ ë‚´ë¦¬ëŠ” ê²¨ìš¸ìž…ë‹ˆë‹¤. í•™ë¶€ëª¨ë‹˜ ê°€ì •ì— ë”°ëœ»í•œ ì˜¨ê¸°ê°€ ê°€ë“í•˜ê¸°ë¥¼ ê¸°ì›í•©ë‹ˆë‹¤.",
      "ì¶”ìš´ ê²¨ìš¸ì´ì§€ë§Œ ë§ˆìŒë§Œì€ ë”°ëœ»í•œ ì—°ë§ì—°ì‹œ ë˜ì‹œê¸°ë¥¼ ë°”ëžë‹ˆë‹¤.",
      "í•œ í•´ë¥¼ ì •ë¦¬í•˜ëŠ” ê²¨ìš¸ì„ ë§žì•„ í•™ë¶€ëª¨ë‹˜ê»˜ ê°ì‚¬ì˜ ë§ˆìŒì„ ì „í•©ë‹ˆë‹¤."
    ]
  }
};

/**
 * í•™ìƒ ì¹­ì°¬ ì–´íœ˜ì§‘ (ì—°êµ¬ ë¬¸ì„œ ì œ3ìž¥ ê¸°ë°˜)
 * í•œêµ­ êµìœ¡ë¬¸í™”ì˜ ì´ìƒì  í•™ìƒìƒì„ ìœ„í•œ ì¹­ì°¬ í‘œí˜„ ì§‘í•©
 */
const PRAISE_VOCABULARY = {
  diligence: [
    "ë¬µë¬µí•˜ê²Œ ìžê¸° í•  ì¼ì„ í•˜ê³  ì„±ì‹¤í•©ë‹ˆë‹¤",
    "ì£¼ì–´ì§„ ê³¼ì œë¥¼ ì±…ìž„ê° ìžˆê²Œ ì™„ìˆ˜í•˜ëŠ” ì•„ì´ìž…ë‹ˆë‹¤",
    "ê¾¸ì¤€ížˆ ë…¸ë ¥í•˜ëŠ” ëª¨ìŠµì´ ì¸ìƒì ìž…ë‹ˆë‹¤"
  ],
  leadership: [
    "ì§€ë„ë ¥ì´ ìžˆê³  ë§¤ì‚¬ì— ì ê·¹ì ì´ì–´ì„œ í•™ìŠµì¼ì— í˜‘ì¡°ì ìž…ë‹ˆë‹¤",
    "ê¸‰ìš°ë“¤ì„ ìž˜ ì´ëŒì–´ê°€ëŠ” ë¦¬ë”ì‹­ì„ ë³´ì—¬ì¤ë‹ˆë‹¤",
    "ì†”ì„ ìˆ˜ë²”í•˜ì—¬ ë‹¤ë¥¸ í•™ìƒë“¤ì—ê²Œ ì¢‹ì€ ë³¸ë³´ê¸°ê°€ ë©ë‹ˆë‹¤"
  ],
  cooperation: [
    "ì¹œêµ¬ë“¤ê³¼ í˜‘ë ¥í•˜ì—¬ í™œë™í•˜ëŠ” ê²ƒì„ ì¢‹ì•„í•©ë‹ˆë‹¤",
    "ë‹¤ë¥¸ ì‚¬ëžŒì„ ë°°ë ¤í•˜ëŠ” ë§ˆìŒì´ ë”°ëœ»í•œ ì•„ì´ìž…ë‹ˆë‹¤",
    "ë‹¨ì²´ í™œë™ì—ì„œ ì¡°í™”ë¥¼ ì´ë£¨ë©° ì°¸ì—¬í•©ë‹ˆë‹¤"
  ],
  creativity: [
    "ì°½ì˜ì ì¸ ìƒê°ì„ ê°€ì§€ê³  ìžˆìœ¼ë©° í‘œí˜„ë ¥ì´ ë›°ì–´ë‚©ë‹ˆë‹¤",
    "ë…ì°½ì ì¸ ì•„ì´ë””ì–´ë¡œ í™œë™ì„ í’ì„±í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤",
    "ìƒìƒë ¥ì´ í’ë¶€í•˜ê³  ì˜ˆìˆ ì  ê°ê°ì´ ë›°ì–´ë‚©ë‹ˆë‹¤"
  ],
  responsibility: [
    "ë§¡ì€ ì¼ì— ëŒ€í•œ ì±…ìž„ê°ì´ ê°•í•©ë‹ˆë‹¤",
    "ìžì‹ ì˜ ì—­í• ì„ ì¶©ì‹¤ížˆ ìˆ˜í–‰í•˜ëŠ” ì‹ ë¢°í•  ìˆ˜ ìžˆëŠ” í•™ìƒìž…ë‹ˆë‹¤",
    "ì•½ì†ì„ ìž˜ ì§€í‚¤ê³  ê·œì¹™ì„ ì¤€ìˆ˜í•˜ëŠ” ëª¨ë²”ì ì¸ íƒœë„ë¥¼ ë³´ìž…ë‹ˆë‹¤"
  ]
};

/**
 * ì•ˆì „ ë° ê±´ê°• êµìœ¡ ëª¨ë“ˆ (ì—°êµ¬ ë¬¸ì„œ ì œ3ìž¥ ë³´í˜¸ìž ìœ í˜•)
 * ë°˜ë³µì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ì£¼ì œë³„ ìµœì‹  ì •ë³´ ì œê³µ
 */
const SAFETY_HEALTH_MODULES = {
  traffic_safety: {
    title: "êµí†µì•ˆì „ ìˆ˜ì¹™",
    content: [
      "ë“±í•˜êµì‹œ íš¡ë‹¨ë³´ë„ì—ì„œëŠ” ì¢Œìš°ë¥¼ ì‚´í”¼ê³  ê±´ë„ˆê¸°",
      "ìžì „ê±° ì´ìš©ì‹œ ì•ˆì „ëª¨ ì°©ìš© í•„ìˆ˜",
      "ìŠ¤ë§ˆíŠ¸í°ì„ ë³´ë©° ê±·ì§€ ì•Šê¸°",
      "êµí†µì‹ í˜¸ ì¤€ìˆ˜í•˜ê¸°"
    ]
  },
  
  cyber_safety: {
    title: "ì‚¬ì´ë²„ ì•ˆì „ ìˆ˜ì¹™",
    content: [
      "ê°œì¸ì •ë³´ ë³´í˜¸í•˜ê¸°",
      "ì•…ì„± ë§í¬ í´ë¦­í•˜ì§€ ì•Šê¸°",
      "ì‚¬ì´ë²„ í­ë ¥ ì‹ ê³ í•˜ê¸°",
      "ê±´ì „í•œ ì¸í„°ë„· ì‚¬ìš©í•˜ê¸°"
    ]
  },
  
  health_management: {
    title: "ê±´ê°• ê´€ë¦¬ ìˆ˜ì¹™",
    content: [
      "ê·œì¹™ì ì¸ ìƒí™œìŠµê´€ ìœ ì§€í•˜ê¸°",
      "ì¶©ë¶„í•œ ìˆ˜ë©´ ì·¨í•˜ê¸°",
      "ê· í˜• ìž¡ížŒ ì‹ì‚¬í•˜ê¸°",
      "ê¾¸ì¤€í•œ ìš´ë™í•˜ê¸°"
    ]
  },
  
  disaster_preparation: {
    title: "ìž¬ë‚œ ëŒ€ë¹„ ìˆ˜ì¹™",
    content: [
      "í™”ìž¬ì‹œ ëŒ€í”¼ ìš”ë ¹ ìˆ™ì§€í•˜ê¸°",
      "ì§€ì§„ ë°œìƒì‹œ ì±…ìƒ ì•„ëž˜ ìˆ¨ê¸°",
      "ë¹„ìƒìš©í’ˆ ìœ„ì¹˜ íŒŒì•…í•˜ê¸°",
      "ê°€ì¡± ë¹„ìƒì—°ë½ë§ í™•ì¸í•˜ê¸°"
    ]
  }
};

/**
 * ê³„ì ˆë³„ ì¸ì‚¬ë§ ìžë™ ìƒì„± í•¨ìˆ˜
 * ì—°êµ¬ ë¬¸ì„œ: "ì‹œê°„ì  í˜„ìž¥ê°ì„ ë¶€ì—¬í•˜ëŠ” ê³„ì ˆ ì¸ì‚¬ì˜ ì¤‘ìš”ì„±"
 */
function generateSeasonalGreeting() {
  const currentDate = new Date();
  const currentMonth = currentDate.getMonth() + 1; // 0-based to 1-based
  
  let seasonKey = 'spring';
  if ([6, 7, 8].includes(currentMonth)) seasonKey = 'summer';
  else if ([9, 10, 11].includes(currentMonth)) seasonKey = 'autumn';
  else if ([12, 1, 2].includes(currentMonth)) seasonKey = 'winter';
  
  const seasonalGreetings = SEASONAL_GREETINGS[seasonKey];
  const randomIndex = Math.floor(Math.random() * seasonalGreetings.length);
  
  return seasonalGreetings[randomIndex];
}

/**
 * í•™ìƒ ì¹­ì°¬ í‘œí˜„ ìƒì„± í•¨ìˆ˜
 * ì—°êµ¬ ë¬¸ì„œ: "ì¹­ì°¬ì˜ ì–´íœ˜ì§‘ - ë¬¸í™”ì ìœ¼ë¡œ ì ì ˆí•˜ê³  ì˜ë¯¸ ìžˆëŠ” í‰ê°€"
 */
function generatePraiseExpressions(traits = []) {
  const expressions = [];
  
  // ê¸°ë³¸ ì„±ê²© íŠ¹ì„±ì— ëŒ€í•œ ì¹­ì°¬ í‘œí˜„ ìƒì„±
  const defaultTraits = traits.length > 0 ? traits : ['diligence', 'cooperation'];
  
  defaultTraits.forEach(trait => {
    if (PRAISE_VOCABULARY[trait]) {
      const traitExpressions = PRAISE_VOCABULARY[trait];
      const randomIndex = Math.floor(Math.random() * traitExpressions.length);
      expressions.push(traitExpressions[randomIndex]);
    }
  });
  
  return expressions.join(', ');
}

/**
 * ì•ˆì „ êµìœ¡ ëª¨ë“ˆ ì„ íƒ í•¨ìˆ˜
 * ì—°êµ¬ ë¬¸ì„œ: "ì‹œì˜ì„± ìžˆëŠ” ìµœì‹  ì•ˆì „ ì •ë³´ ëª¨ë“ˆ"
 */
function getRelevantSafetyModule(safetyType = 'traffic_safety') {
  const module = SAFETY_HEALTH_MODULES[safetyType];
  if (!module) return SAFETY_HEALTH_MODULES.traffic_safety;
  
  return {
    title: module.title,
    bulletPoints: module.content.map(item => `â€¢ ${item}`).join('\n')
  };
}

// ===== ìƒˆë¡œìš´ AI í”„ë¡¬í”„íŠ¸ ìƒì„± ì‹œìŠ¤í…œ =====

/**
 * ì—°êµ¬ ë¬¸ì„œ ê¸°ë°˜ ì™„ì „í•œ AI í”„ë¡¬í”„íŠ¸ ìƒì„±ê¸°
 * í”Œë ˆì´ìŠ¤í™€ë” ë…¸ì¶œ ë¬¸ì œ ì™„ì „ í•´ê²°
 */
class NoticePromptGenerator {
  constructor() {
    this.currentDate = new Date();
    this.seasonalGreeting = generateSeasonalGreeting();
  }

  /**
   * í–‰ì‚¬ ì•ˆë‚´ í†µì‹ ë¬¸ ìƒì„±ì„ ìœ„í•œ AI í”„ë¡¬í”„íŠ¸
   */
  generateEventPrompt(data) {
    const {
      eventName = 'í•™êµ í–‰ì‚¬',
      eventDate = 'ì¶”í›„ ì•ˆë‚´',
      eventTime = 'ì¶”í›„ ì•ˆë‚´',
      eventLocation = 'í•™êµ ë‚´',
      eventTarget = 'ì „êµìƒ',
      eventPurpose = 'í•™ìƒë“¤ì˜ ê±´ì „í•œ ì„±ìž¥',
      eventProgram = 'ë‹¤ì–‘í•œ í”„ë¡œê·¸ëž¨',
      contactInfo = 'í•™êµ êµë¬´ì‹¤',
      schoolLevel = 'elementary'
    } = data;

    return `ë‹¹ì‹ ì€ ê²½í—˜ ë§Žê³  ë”°ëœ»í•œ ë‹´ìž„êµì‚¬ìž…ë‹ˆë‹¤. í•™ë¶€ëª¨ë‹˜ë“¤ê»˜ í•™êµ í–‰ì‚¬ë¥¼ ì•ˆë‚´í•˜ëŠ” ìžì—°ìŠ¤ëŸ½ê³  ì •ì¤‘í•œ ê°€ì •í†µì‹ ë¬¸ì„ ìž‘ì„±í•´ì£¼ì„¸ìš”.

ë‹¤ìŒ êµ¬ì¡°ë¡œ ì™„ì„±ëœ í†µì‹ ë¬¸ì„ ìž‘ì„±í•˜ë˜, ëª¨ë“  ë‚´ìš©ì´ ìžì—°ìŠ¤ëŸ½ê²Œ í˜ëŸ¬ê°€ë„ë¡ í•´ì£¼ì„¸ìš”:

**1. ì •ì¤‘í•œ ì¸ì‚¬**
${this.seasonalGreeting}

**2. í–‰ì‚¬ ì†Œê°œ ë° ì˜ë¯¸**
"${eventName}"ëŠ” ${eventPurpose}ë¥¼ í†µí•´ ìš°ë¦¬ ì•„ì´ë“¤ì´ ë”ìš± ì˜ë¯¸ìžˆëŠ” í•™êµìƒí™œì„ ê²½í—˜í•  ìˆ˜ ìžˆëŠ” ì†Œì¤‘í•œ ê¸°íšŒìž…ë‹ˆë‹¤. ì´ë²ˆ í–‰ì‚¬ë¥¼ í†µí•´ í•™ìƒë“¤ì€ ì¹œêµ¬ë“¤ê³¼ í˜‘ë ¥í•˜ë©° ì„±ìž¥í•˜ê³ , ìƒˆë¡œìš´ ê²½í—˜ì„ í†µí•´ ê¿ˆì„ í‚¤ì›Œë‚˜ê°ˆ ê²ƒìž…ë‹ˆë‹¤.

**3. í–‰ì‚¬ ì„¸ë¶€ ì •ë³´**
- ðŸŽ¯ í–‰ì‚¬ëª…: ${eventName}
- ðŸ“… ì¼ì‹œ: ${eventDate} ${eventTime}
- ðŸ“ ìž¥ì†Œ: ${eventLocation}  
- ðŸ‘¥ ëŒ€ìƒ: ${eventTarget}

**4. í”„ë¡œê·¸ëž¨ ì•ˆë‚´**
${eventProgram}ì„ í†µí•´ í•™ìƒë“¤ì´ ì¦ê²ê³  ë³´ëžŒì°¬ ì‹œê°„ì„ ë³´ë‚¼ ìˆ˜ ìžˆë„ë¡ ì„¸ì‹¬í•˜ê²Œ ì¤€ë¹„í•˜ì˜€ìŠµë‹ˆë‹¤. ê° í”„ë¡œê·¸ëž¨ì€ ì•„ì´ë“¤ì˜ ì°½ì˜ì„±ê³¼ í˜‘ë™ì‹¬ì„ ê¸°ë¥¼ ìˆ˜ ìžˆë„ë¡ êµ¬ì„±ë˜ì–´ ìžˆìŠµë‹ˆë‹¤.

**5. ë‹¹ë¶€ ë§ì”€**
í•™ë¶€ëª¨ë‹˜ì˜ ê´€ì‹¬ê³¼ ê²©ë ¤ê°€ ì•„ì´ë“¤ì—ê²Œ í° íž˜ì´ ë©ë‹ˆë‹¤. í–‰ì‚¬ ì°¸ì—¬ë‚˜ ê¸°íƒ€ ë¬¸ì˜ì‚¬í•­ì´ ìžˆìœ¼ì‹œë©´ ì–¸ì œë“  ${contactInfo}ë¡œ ì—°ë½í•´ì£¼ì‹œê¸° ë°”ëžë‹ˆë‹¤.

**6. ê°ì‚¬ ì¸ì‚¬**
í•­ìƒ í•™êµ êµìœ¡í™œë™ì— ì ê·¹ì ìœ¼ë¡œ í˜‘ì¡°í•´ì£¼ì‹œëŠ” í•™ë¶€ëª¨ë‹˜ê»˜ ê¹Šì€ ê°ì‚¬ë¥¼ ë“œë¦½ë‹ˆë‹¤. ì•žìœ¼ë¡œë„ ìš°ë¦¬ ì•„ì´ë“¤ì˜ ê±´ê°•í•œ ì„±ìž¥ì„ ìœ„í•´ í•¨ê»˜í•´ì£¼ì‹œê¸° ë°”ëžë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤.

${formatKoreanDate(this.currentDate)}
â—‹â—‹í•™êµìž¥

ìœ„ êµ¬ì¡°ë¥¼ ì°¸ê³ í•˜ì—¬ ìžì—°ìŠ¤ëŸ½ê³  ì™„ì„±ëœ ê°€ì •í†µì‹ ë¬¸ì„ ìž‘ì„±í•´ì£¼ì„¸ìš”. ëª¨ë“  ì •ë³´ê°€ ìžì—°ìŠ¤ëŸ½ê²Œ í†µí•©ë˜ì–´ì•¼ í•˜ë©°, ë”±ë”±í•˜ì§€ ì•Šê³  ë”°ëœ»í•œ ëŠë‚Œì´ ë“¤ë„ë¡ í•´ì£¼ì„¸ìš”.`;
  }

  /**
   * ì„±ì í‘œ ë™ë´‰ íŽ¸ì§€ë¥¼ ìœ„í•œ AI í”„ë¡¬í”„íŠ¸
   */
  generateGradePrompt(data) {
    const {
      studentName = 'í•™ìƒ',
      academicProgress = 'ê¾¸ì¤€í•œ ë…¸ë ¥ì„ ë³´ì´ê³  ìžˆìŠµë‹ˆë‹¤',
      studentStrengths = 'ì„±ì‹¤í•˜ê³  ì±…ìž„ê°ì´ ê°•í•©ë‹ˆë‹¤',
      improvementAreas = 'ìžì‹ ê°ì„ ê°€ì§€ê³  ì ê·¹ì ìœ¼ë¡œ ì°¸ì—¬í•˜ë©´ ì¢‹ê² ìŠµë‹ˆë‹¤',
      encouragementMessage = 'ì•žìœ¼ë¡œì˜ ì„±ìž¥ì´ ë”ìš± ê¸°ëŒ€ë©ë‹ˆë‹¤'
    } = data;

    const praiseExpressions = generatePraiseExpressions(['diligence', 'cooperation']);

    return `ë‹¹ì‹ ì€ í•™ìƒ í•œ ëª… í•œ ëª…ì„ ì„¸ì‹¬í•˜ê²Œ ê´€ì°°í•˜ê³  ì‚¬ëž‘í•˜ëŠ” ë‹´ìž„êµì‚¬ìž…ë‹ˆë‹¤. ì„±ì í‘œì™€ í•¨ê»˜ í•™ë¶€ëª¨ë‹˜ê»˜ ë³´ë‚´ëŠ” ë”°ëœ»í•˜ê³  ê²©ë ¤ê°€ ë‹´ê¸´ íŽ¸ì§€ë¥¼ ìž‘ì„±í•´ì£¼ì„¸ìš”.

ë‹¤ìŒê³¼ ê°™ì€ íë¦„ìœ¼ë¡œ ìžì—°ìŠ¤ëŸ½ê³  ê°œì¸ì ì¸ íŽ¸ì§€ë¥¼ ìž‘ì„±í•´ì£¼ì„¸ìš”:

**1. ë§ˆìŒì„ ë‹´ì€ ì¸ì‚¬**
${this.seasonalGreeting}

ì•ˆë…•í•˜ì‹­ë‹ˆê¹Œ? ì˜¤ëŠ˜ ${studentName} í•™ìƒì˜ ì„±ì í‘œë¥¼ ì „í•´ë“œë¦¬ë©´ì„œ, í•œ í•™ê¸° ë™ì•ˆ í•¨ê»˜í•˜ë©° ì§€ì¼œë³¸ ${studentName}ì˜ ì†Œì¤‘í•œ ì„±ìž¥ ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ„ê³  ì‹¶ì–´ ì´ë ‡ê²Œ íŽ¸ì§€ë¥¼ ì“°ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

**2. í•™ìƒì˜ íŠ¹ë³„í•œ ëª¨ìŠµë“¤**
${studentName}ëŠ” ${praiseExpressions}í•˜ë©°, íŠ¹ížˆ ${studentStrengths}í•œ ëª¨ìŠµì´ ì„ ìƒë‹˜ì˜ ë§ˆìŒì„ ë”°ëœ»í•˜ê²Œ í•´ì£¼ì—ˆìŠµë‹ˆë‹¤. ${academicProgress}í•œ ì ì—ì„œ ${studentName}ë§Œì˜ íŠ¹ë³„í•¨ì„ ë°œê²¬í•  ìˆ˜ ìžˆì—ˆìŠµë‹ˆë‹¤.

**3. ì„±ìž¥ì˜ ì˜ë¯¸**
ì„±ì í‘œëŠ” ìˆ«ìžë¡œ ë‚˜íƒ€ë‚˜ì§€ë§Œ, ì§„ì •í•œ ë°°ì›€ì€ ì ìˆ˜ë¡œ ì¸¡ì •í•  ìˆ˜ ì—†ëŠ” ë§ˆìŒì˜ ì„±ìž¥ì— ìžˆë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤. ${studentName}ê°€ ë³´ì—¬ì¤€ ë…¸ë ¥ê³¼ ì„±ì‹¤í•¨, ê·¸ë¦¬ê³  ì¹œêµ¬ë“¤ì„ ë°°ë ¤í•˜ëŠ” ë”°ëœ»í•œ ë§ˆìŒì´ì•¼ë§ë¡œ ê°€ìž¥ ì†Œì¤‘í•œ ì„±ê³¼ë¼ê³  í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

**4. í•¨ê»˜ í‚¤ì›Œë‚˜ê°ˆ ë¶€ë¶„**
ì•žìœ¼ë¡œ ${improvementAreas}í•˜ë©´ ${studentName}ì˜ ìˆ¨ì–´ìžˆëŠ” ìž¬ëŠ¥ê³¼ ê°€ëŠ¥ì„±ì´ ë”ìš± ë¹›ë‚  ê²ƒì´ë¼ í™•ì‹ í•©ë‹ˆë‹¤. ì´ëŠ” ë‹¨ì ì´ ì•„ë‹ˆë¼ ${studentName}ê°€ ë”ìš± ì„±ìž¥í•  ìˆ˜ ìžˆëŠ” ì—¬ì§€ì´ìž ê¸°íšŒìž…ë‹ˆë‹¤.

**5. ê²©ë ¤ì™€ ì „ë§**
${encouragementMessage}. í•™ë¶€ëª¨ë‹˜ì˜ ì‚¬ëž‘ê³¼ ê²©ë ¤, ê·¸ë¦¬ê³  ì„ ìƒë‹˜ì˜ ê´€ì‹¬ì´ í•¨ê»˜í•œë‹¤ë©´ ${studentName}ëŠ” ë¶„ëª…ížˆ ìžì‹ ë§Œì˜ íŠ¹ë³„í•œ ê¿ˆì„ ì´ë£¨ì–´ë‚¼ ê²ƒìž…ë‹ˆë‹¤.

**6. ê°ì‚¬ ì¸ì‚¬**
í•­ìƒ ${studentName}ì˜ êµìœ¡ì— ê¹Šì€ ê´€ì‹¬ì„ ê°€ì ¸ì£¼ì‹œê³  í•™êµ í™œë™ì— ì ê·¹ í˜‘ì¡°í•´ì£¼ì‹œëŠ” í•™ë¶€ëª¨ë‹˜ê»˜ ì§„ì‹¬ìœ¼ë¡œ ê°ì‚¬ë“œë¦½ë‹ˆë‹¤.

${formatKoreanDate(this.currentDate)}
ë‹´ìž„êµì‚¬ ì˜¬ë¦¼

ìœ„ êµ¬ì¡°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ${studentName} í•™ìƒì—ê²Œ íŠ¹í™”ëœ ë”°ëœ»í•˜ê³  ê°œì¸ì ì¸ íŽ¸ì§€ë¥¼ ìž‘ì„±í•´ì£¼ì„¸ìš”. ì„±ì ë³´ë‹¤ëŠ” í•™ìƒì˜ ì¸ê²©ê³¼ ì„±ìž¥ì— ì´ˆì ì„ ë§žì¶˜ ê²©ë ¤ì˜ ë©”ì‹œì§€ê°€ ë˜ë„ë¡ í•´ì£¼ì„¸ìš”.`;
  }

  /**
   * ì•ˆì „ êµìœ¡ í†µì‹ ë¬¸ì„ ìœ„í•œ AI í”„ë¡¬í”„íŠ¸
   */
  generateSafetyPrompt(data) {
    const {
      safetyTopic = 'traffic_safety',
      urgencyLevel = 'moderate',
      specificInstructions = 'ì•ˆì „ ìˆ˜ì¹™ì„ ìž˜ ì§€ì¼œì£¼ì‹œê¸° ë°”ëžë‹ˆë‹¤',
      backgroundInfo = 'ìµœê·¼ ì•ˆì „ì‚¬ê³  ì˜ˆë°©ì˜ ì¤‘ìš”ì„±ì´ ëŒ€ë‘ë˜ê³  ìžˆìŠµë‹ˆë‹¤'
    } = data;

    const safetyModule = getRelevantSafetyModule(safetyTopic);
    const tone = urgencyLevel === 'high' ? 'ê¸´ê¸‰í•˜ê³  ë‹¨í˜¸í•œ' : 'ì •ì¤‘í•˜ì§€ë§Œ í™•ì‹¤í•œ';

    return `ë‹¹ì‹ ì€ í•™ìƒë“¤ì˜ ì•ˆì „ì„ ìµœìš°ì„ ìœ¼ë¡œ ìƒê°í•˜ëŠ” ë‹´ìž„êµì‚¬ìž…ë‹ˆë‹¤. í•™ë¶€ëª¨ë‹˜ë“¤ê»˜ ì¤‘ìš”í•œ ì•ˆì „ êµìœ¡ ë‚´ìš©ì„ ì „ë‹¬í•˜ëŠ” ${tone} ì–´ì¡°ì˜ ê°€ì •í†µì‹ ë¬¸ì„ ìž‘ì„±í•´ì£¼ì„¸ìš”.

ë‹¤ìŒê³¼ ê°™ì€ êµ¬ì¡°ë¡œ ì•ˆì „ì˜ ì¤‘ìš”ì„±ì„ ê°•ì¡°í•˜ë©´ì„œë„ ì‹¤í–‰ ê°€ëŠ¥í•œ ì§€ì¹¨ì„ ì œê³µí•´ì£¼ì„¸ìš”:

**1. ì •ì¤‘í•œ ì¸ì‚¬**
${this.seasonalGreeting}

**2. ì•ˆì „ êµìœ¡ì˜ ì¤‘ìš”ì„±**
${backgroundInfo}. ìš°ë¦¬ ì•„ì´ë“¤ì˜ ì†Œì¤‘í•œ ìƒëª…ê³¼ ì•ˆì „ì„ ì§€í‚¤ê¸° ìœ„í•´ì„œëŠ” í•™êµì™€ ê°€ì •ì´ í•¨ê»˜ ë…¸ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.

**3. ${safetyModule.title}**
ë‹¤ìŒ ì‚¬í•­ë“¤ì„ ìžë…€ì™€ í•¨ê»˜ í™•ì¸í•˜ê³  ì‹¤ì²œí•´ì£¼ì‹œê¸° ë°”ëžë‹ˆë‹¤:

${safetyModule.bulletPoints}

**4. ê°€ì •ì—ì„œì˜ ì•ˆì „ êµìœ¡**
${specificInstructions}. íŠ¹ížˆ í‰ìƒì‹œ ìžë…€ì™€ ì•ˆì „ì— ëŒ€í•´ ëŒ€í™”í•˜ì‹œë©°, ìœ„í—˜ ìƒí™©ì— ëŒ€í•œ ëŒ€ì²˜ ë°©ë²•ì„ ë¯¸ë¦¬ ì•Œë ¤ì£¼ì‹œë©´ í° ë„ì›€ì´ ë©ë‹ˆë‹¤.

**5. í˜‘ì¡° ë‹¹ë¶€**
ì•„ì´ë“¤ì˜ ì•ˆì „ì€ ì•„ë¬´ë¦¬ ê°•ì¡°í•´ë„ ì§€ë‚˜ì¹˜ì§€ ì•ŠìŠµë‹ˆë‹¤. í•™ë¶€ëª¨ë‹˜ì˜ ì„¸ì‹¬í•œ ê´€ì‹¬ê³¼ ì§€ì†ì ì¸ ì•ˆì „ êµìœ¡ì´ ìš°ë¦¬ ì•„ì´ë“¤ì„ ì§€í‚¤ëŠ” ê°€ìž¥ í™•ì‹¤í•œ ë°©ë²•ìž…ë‹ˆë‹¤.

**6. ê°ì‚¬ ì¸ì‚¬**
í•­ìƒ ìžë…€ ì•ˆì „ì— ê¹Šì€ ê´€ì‹¬ì„ ê°€ì ¸ì£¼ì‹œëŠ” í•™ë¶€ëª¨ë‹˜ê»˜ ê°ì‚¬ë“œë¦¬ë©°, ê¶ê¸ˆí•œ ì‚¬í•­ì´ ìžˆìœ¼ì‹œë©´ ì–¸ì œë“  ì—°ë½ì£¼ì‹œê¸° ë°”ëžë‹ˆë‹¤.

${formatKoreanDate(this.currentDate)}
â—‹â—‹í•™êµìž¥

ìœ„ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ${safetyTopic}ì— ê´€í•œ ì‹¤ìš©ì ì´ê³  ì„¤ë“ë ¥ ìžˆëŠ” ì•ˆì „ êµìœ¡ í†µì‹ ë¬¸ì„ ìž‘ì„±í•´ì£¼ì„¸ìš”. ë‹¨ìˆœí•œ ë‚˜ì—´ì´ ì•„ë‹ˆë¼ í•™ë¶€ëª¨ë‹˜ë“¤ì´ ì‹¤ì œë¡œ ì‹¤ì²œí•  ìˆ˜ ìžˆëŠ” êµ¬ì²´ì ì¸ ë°©ë²•ì„ ì œì‹œí•´ì£¼ì„¸ìš”.`;
  }

  /**
   * ì„¤ë¬¸ì¡°ì‚¬/ë™ì˜ì„œ ìš”ì²­ì„ ìœ„í•œ AI í”„ë¡¬í”„íŠ¸  
   */
  generateSurveyPrompt(data) {
    const {
      surveyTitle = 'í•™êµ êµìœ¡ ê´€ë ¨ ì„¤ë¬¸ì¡°ì‚¬',
      surveyPurpose = 'êµìœ¡ í™œë™ ê°œì„ ',
      deadline = 'ì¶”í›„ ì•ˆë‚´',
      surveyMethod = 'ì˜¨ë¼ì¸ ì„¤ë¬¸',
      respondents = 'ì „ì²´ í•™ë¶€ëª¨',
      estimatedTime = 'ì•½ 10ë¶„'
    } = data;

    return `ë‹¹ì‹ ì€ í•™êµ êµìœ¡ ê°œì„ ì„ ìœ„í•´ í•™ë¶€ëª¨ë‹˜ì˜ ì˜ê²¬ì„ ì†Œì¤‘ížˆ ì—¬ê¸°ëŠ” ë‹´ìž„êµì‚¬ìž…ë‹ˆë‹¤. ì„¤ë¬¸ì¡°ì‚¬ ì°¸ì—¬ë¥¼ ìš”ì²­í•˜ëŠ” ì •ì¤‘í•˜ê³  í˜‘ì¡°ì ì¸ ê°€ì •í†µì‹ ë¬¸ì„ ìž‘ì„±í•´ì£¼ì„¸ìš”.

ë‹¤ìŒê³¼ ê°™ì€ êµ¬ì¡°ë¡œ ì„¤ë¬¸ì¡°ì‚¬ì˜ ëª©ì ê³¼ ì¤‘ìš”ì„±ì„ ì„¤ëª…í•˜ë©° ì°¸ì—¬ë¥¼ ë…ë ¤í•´ì£¼ì„¸ìš”:

**1. ì •ì¤‘í•œ ì¸ì‚¬**  
${this.seasonalGreeting}

**2. ì„¤ë¬¸ì¡°ì‚¬ ëª©ì  ì„¤ëª…**
ë” ë‚˜ì€ êµìœ¡í™˜ê²½ì„ ë§Œë“¤ê¸° ìœ„í•´ "${surveyTitle}"ë¥¼ ì‹¤ì‹œí•˜ê³ ìž í•©ë‹ˆë‹¤. ì´ë²ˆ ì„¤ë¬¸ì¡°ì‚¬ëŠ” ${surveyPurpose}ì„ í†µí•´ ìš°ë¦¬ ì•„ì´ë“¤ì—ê²Œ ë”ìš± í–¥ìƒëœ êµìœ¡ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ê¸° ìœ„í•¨ìž…ë‹ˆë‹¤.

**3. ì„¤ë¬¸ì¡°ì‚¬ ê°œìš”**
- ðŸ“‹ ì„¤ë¬¸ ì œëª©: ${surveyTitle}
- ðŸŽ¯ ëª©ì : ${surveyPurpose}  
- ðŸ‘¥ ëŒ€ìƒ: ${respondents}
- â° ì†Œìš” ì‹œê°„: ${estimatedTime}
- ðŸ“… ë§ˆê°ì¼: ${deadline}
- ðŸ“± ì°¸ì—¬ ë°©ë²•: ${surveyMethod}

**4. ì°¸ì—¬ ë°©ë²• ì•ˆë‚´**
ì„¤ë¬¸ì¡°ì‚¬ëŠ” ${surveyMethod}ë¡œ ì§„í–‰ë˜ë©°, ìµëª…ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤. í•™ë¶€ëª¨ë‹˜ì˜ ì†Œì¤‘í•œ ì˜ê²¬ì€ í•™êµ êµìœ¡ ì •ì±… ìˆ˜ë¦½ê³¼ í”„ë¡œê·¸ëž¨ ê°œì„ ì— ê·€ì¤‘í•œ ìžë£Œë¡œ í™œìš©ë  ê²ƒìž…ë‹ˆë‹¤.

**5. ê°œì¸ì •ë³´ ë³´í˜¸**
ì„¤ë¬¸ì¡°ì‚¬ ê³¼ì •ì—ì„œ ìˆ˜ì§‘ë˜ëŠ” ëª¨ë“  ì •ë³´ëŠ” ê°œì¸ì •ë³´ë³´í˜¸ë²•ì— ë”°ë¼ ì•ˆì „í•˜ê²Œ ê´€ë¦¬ë˜ë©°, ì—°êµ¬ ëª©ì  ì´ì™¸ì—ëŠ” ì‚¬ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

**6. í˜‘ì¡° ìš”ì²­ ë° ê°ì‚¬**
ë°”ì˜ì‹  ì¤‘ì—ë„ ìš°ë¦¬ ì•„ì´ë“¤ì˜ êµìœ¡ì„ ìœ„í•´ ì‹œê°„ì„ ë‚´ì–´ì£¼ì‹œëŠ” í•™ë¶€ëª¨ë‹˜ê»˜ ê¹Šì€ ê°ì‚¬ë¥¼ ë“œë¦½ë‹ˆë‹¤. ì—¬ëŸ¬ë¶„ì˜ ì°¸ì—¬ê°€ ë” ë‚˜ì€ êµìœ¡í™˜ê²½ì„ ë§Œë“œëŠ” ë°‘ê±°ë¦„ì´ ë©ë‹ˆë‹¤.

ë¬¸ì˜ì‚¬í•­ì´ ìžˆìœ¼ì‹œë©´ ì–¸ì œë“  í•™êµë¡œ ì—°ë½ì£¼ì‹œê¸° ë°”ëžë‹ˆë‹¤.

${formatKoreanDate(this.currentDate)}
â—‹â—‹í•™êµìž¥

ìœ„ êµ¬ì¡°ë¥¼ ë°”íƒ•ìœ¼ë¡œ "${surveyTitle}"ì— ëŒ€í•œ í•™ë¶€ëª¨ë‹˜ë“¤ì˜ ì ê·¹ì ì¸ ì°¸ì—¬ë¥¼ ì´ëŒì–´ë‚¼ ìˆ˜ ìžˆëŠ” ì„¤ë“ë ¥ ìžˆëŠ” í†µì‹ ë¬¸ì„ ìž‘ì„±í•´ì£¼ì„¸ìš”. ì„¤ë¬¸ì¡°ì‚¬ì˜ ê°€ì¹˜ì™€ ì¤‘ìš”ì„±ì„ ìžì—°ìŠ¤ëŸ½ê²Œ ê°•ì¡°í•´ì£¼ì„¸ìš”.`;
  }

  /**
   * ê°œë³„ í•™ìƒ í”¼ë“œë°±ì„ ìœ„í•œ AI í”„ë¡¬í”„íŠ¸
   */
  generateFeedbackPrompt(data) {
    const {
      studentName = 'í•™ìƒ',
      observationPeriod = 'ì´ë²ˆ í•™ê¸°',
      specificBehaviors = 'ì„±ì‹¤í•˜ê³  ì ê·¹ì ì¸ í•™ìŠµ íƒœë„',
      achievements = 'ê¾¸ì¤€í•œ ì‹¤ë ¥ í–¥ìƒ',  
      socialInteraction = 'ì¹œêµ¬ë“¤ê³¼ í˜‘ë ¥ì ì¸ ê´€ê³„',
      recommendedSupport = 'ìžì‹ ê°ì„ ê°€ì§€ê³  ë„ì „í•˜ê¸°',
      futureGoals = 'ë”ìš± ë°œì „ëœ ëª¨ìŠµ'
    } = data;

    return `ë‹¹ì‹ ì€ ${studentName} í•™ìƒì„ ì„¸ì‹¬í•˜ê²Œ ê´€ì°°í•˜ê³  ê¹Šì´ ì´í•´í•˜ëŠ” ë‹´ìž„êµì‚¬ìž…ë‹ˆë‹¤. ${observationPeriod} ë™ì•ˆ ì§€ì¼œë³¸ ${studentName}ì˜ ì„±ìž¥ê³¼ ë°œì „ì— ëŒ€í•´ í•™ë¶€ëª¨ë‹˜ê»˜ ìƒì„¸í•˜ê³  ë”°ëœ»í•œ ê°œë³„ í”¼ë“œë°±ì„ ì „ë‹¬í•´ì£¼ì„¸ìš”.

ë‹¤ìŒê³¼ ê°™ì€ êµ¬ì¡°ë¡œ ${studentName}ì—ê²Œ íŠ¹í™”ëœ ê°œì¸ì ì´ê³  êµ¬ì²´ì ì¸ íŽ¸ì§€ë¥¼ ìž‘ì„±í•´ì£¼ì„¸ìš”:

**1. ê°œì¸ì ì¸ ì¸ì‚¬**
${this.seasonalGreeting}

ì•ˆë…•í•˜ì‹­ë‹ˆê¹Œ? ${observationPeriod} ë™ì•ˆ ${studentName}ì™€ í•¨ê»˜ ë³´ë‚¸ ì†Œì¤‘í•œ ì‹œê°„ë“¤ì„ ë˜ëŒì•„ë³´ë©°, ì´ ì•„ì´ë§Œì˜ íŠ¹ë³„í•œ ì„±ìž¥ ì´ì•¼ê¸°ë¥¼ í•™ë¶€ëª¨ë‹˜ê³¼ ë‚˜ëˆ„ê³  ì‹¶ì–´ íŽœì„ ë“¤ì—ˆìŠµë‹ˆë‹¤.

**2. ${studentName}ë§Œì˜ íŠ¹ë³„í•œ ìˆœê°„ë“¤**
${studentName}ê°€ ë³´ì—¬ì¤€ ${specificBehaviors}ëŠ” ì •ë§ ì¸ìƒì ì´ì—ˆìŠµë‹ˆë‹¤. íŠ¹ížˆ ê¸°ì–µì— ë‚¨ëŠ” ê²ƒì€:
- ìˆ˜ì—… ì‹œê°„ì— ë³´ì—¬ì¤€ ì§‘ì¤‘ë ¥ê³¼ ì ê·¹ì ì¸ ì°¸ì—¬ ìžì„¸
- ì–´ë ¤ìš´ ë¬¸ì œë¥¼ ë§Œë‚˜ë„ í¬ê¸°í•˜ì§€ ì•Šê³  ëê¹Œì§€ í•´ê²°í•˜ë ¤ëŠ” ì˜ì§€  
- ì¹œêµ¬ë“¤ì„ ë„ì™€ì£¼ëŠ” ë”°ëœ»í•œ ë§ˆìŒê³¼ ë°°ë ¤ì‹¬
- ìƒˆë¡œìš´ ê²ƒì„ ë°°ìš¸ ë•Œ ë³´ì´ëŠ” ë°˜ì§ì´ëŠ” ëˆˆë¹›

**3. ëˆˆì— ë„ëŠ” ì„±ìž¥ê³¼ ë°œì „**
${achievements}ì„ í†µí•´ ${studentName}ì˜ ë°œì „ì„ í™•ì‹¤ížˆ ëŠë‚„ ìˆ˜ ìžˆì—ˆìŠµë‹ˆë‹¤. ë˜í•œ ${socialInteraction}ì„ ë³´ë©°, ì´ ì•„ì´ê°€ ë‹¨ìˆœížˆ í•™ì—…ì ìœ¼ë¡œë§Œ ì„±ìž¥í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ í•œ ëª…ì˜ í›Œë¥­í•œ ì‚¬ëžŒìœ¼ë¡œ ìžë¼ë‚˜ê³  ìžˆìŒì„ ì‹¤ê°í•©ë‹ˆë‹¤.

**4. í•¨ê»˜ í‚¤ì›Œë‚˜ê°€ê³  ì‹¶ì€ ë³´ë¬¼ë“¤**  
${studentName}ê°€ ${recommendedSupport}í•˜ë©´ ìˆ¨ì–´ìžˆëŠ” ìž¬ëŠ¥ë“¤ì´ ë”ìš± ë¹›ë‚  ê²ƒìž…ë‹ˆë‹¤. ì´ëŠ” ë¶€ì¡±í•¨ì´ ì•„ë‹ˆë¼, ì´ ì•„ì´ê°€ ë” í° ê°€ëŠ¥ì„±ì„ ê°€ì§€ê³  ìžˆë‹¤ëŠ” ì¦ê±°ìž…ë‹ˆë‹¤.

**5. ê°€ì •ì—ì„œì˜ ê²©ë ¤ ë°©ë²•**
- ${studentName}ì˜ ìž‘ì€ ì‹œë„ì™€ ë…¸ë ¥ì— ëŒ€í•´ êµ¬ì²´ì ìœ¼ë¡œ ì¸ì •í•´ì£¼ì„¸ìš”
- ê²°ê³¼ë³´ë‹¤ëŠ” ê³¼ì •ê³¼ ë…¸ë ¥ì„ ì¹­ì°¬í•´ì£¼ì„¸ìš”  
- ì‹¤ìˆ˜ë¥¼ í–ˆì„ ë•Œë„ ë‹¤ì‹œ ì‹œìž‘í•  ìˆ˜ ìžˆë‹¤ëŠ” ìš©ê¸°ë¥¼ ì£¼ì„¸ìš”
- ${studentName}ë§Œì˜ ì†ë„ì™€ ë°©ì‹ì„ ì¡´ì¤‘í•´ì£¼ì„¸ìš”

**6. ë¯¸ëž˜ì— ëŒ€í•œ ê¸°ëŒ€**
ì•žìœ¼ë¡œ ${studentName}ê°€ ë³´ì—¬ì¤„ ${futureGoals}ê°€ ì •ë§ ê¸°ëŒ€ë©ë‹ˆë‹¤. ì´ ì•„ì´ ì•ˆì—ëŠ” ë¬´í•œí•œ ê°€ëŠ¥ì„±ì´ ìž ë“¤ì–´ ìžˆìœ¼ë©°, ì ì ˆí•œ ì‹œê¸°ì— ì•„ë¦„ë‹µê²Œ ê½ƒí”¼ìš¸ ê²ƒì´ë¼ í™•ì‹ í•©ë‹ˆë‹¤.

í•­ìƒ ${studentName}ì˜ ì„±ìž¥ì„ í•¨ê»˜ ì§€ì¼œë´ ì£¼ì‹œëŠ” í•™ë¶€ëª¨ë‹˜ê»˜ ê¹Šì€ ê°ì‚¬ë¥¼ ë“œë¦½ë‹ˆë‹¤.

${formatKoreanDate(this.currentDate)}
ë‹´ìž„êµì‚¬ ì˜¬ë¦¼

ìœ„ êµ¬ì¡°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ${studentName} í•™ìƒì—ê²Œë§Œ í•´ë‹¹í•˜ëŠ” êµ¬ì²´ì ì´ê³  ê°œì¸ì ì¸ ê´€ì°° ë‚´ìš©ì´ ë‹´ê¸´ ë”°ëœ»í•œ í”¼ë“œë°±ì„ ìž‘ì„±í•´ì£¼ì„¸ìš”. ì´ ì•„ì´ë§Œì˜ ë…íŠ¹í•œ íŠ¹ì„±ê³¼ ì„±ìž¥ ëª¨ìŠµì´ ìƒìƒí•˜ê²Œ ë“œëŸ¬ë‚˜ë„ë¡ í•´ì£¼ì„¸ìš”.`;
  }
}

/**
 * ë©”ì¸ AI ê°€ì •í†µì‹ ë¬¸ ìƒì„± í•¨ìˆ˜ - ì™„ì „ ìž¬ì„¤ê³„
 * ì—°êµ¬ ë¬¸ì„œ ê¸°ë°˜ êµ¬ì¡°ì  ì§„ì •ì„±ê³¼ ìžì—°ìŠ¤ëŸ¬ìš´ ì™„ì„±ë„ ë³´ìž¥
 */
export async function generateProfessionalNotice(requestData, apiKeyOverride = undefined) {
  console.log('ðŸš€ ìƒˆë¡œìš´ AI ê°€ì •í†µì‹ ë¬¸ ìƒì„±ê¸° ì‹¤í–‰');
  console.log('ðŸ“¥ ìš”ì²­ ë°ì´í„°:', JSON.stringify(requestData, null, 2));
  
  try {
    const { 
      category, 
      schoolLevel = 'elementary',
      ...restData 
    } = requestData;
    
    console.log('ðŸ“‚ ì¹´í…Œê³ ë¦¬:', category);
    console.log('ðŸŽ“ í•™êµê¸‰:', schoolLevel);
    
    // ë‚ ì§œ ë° ë°°ì—´ ë°ì´í„° ì „ì²˜ë¦¬
    const processedData = { ...restData };
    Object.keys(processedData).forEach(key => {
      const value = processedData[key];
      if (value instanceof Date || (typeof value === 'string' && value.match(/^\d{4}-\d{2}-\d{2}/))) {
        processedData[key] = formatKoreanDate(value);
      } else if (Array.isArray(value)) {
        processedData[key] = formatArrayValue(value);
      }
    });
    
    console.log('ðŸ“ ì²˜ë¦¬ëœ ë°ì´í„°:', processedData);
    
    // AI í”„ë¡¬í”„íŠ¸ ìƒì„±ê¸° ì´ˆê¸°í™”
    const promptGenerator = new NoticePromptGenerator();
    
    // ì¹´í…Œê³ ë¦¬ë³„ í”„ë¡¬í”„íŠ¸ ìƒì„±
    let aiPrompt;
    
    switch (category) {
      case 'event_announcement':
        aiPrompt = promptGenerator.generateEventPrompt(processedData);
        break;
      case 'individual_feedback':
        aiPrompt = promptGenerator.generateFeedbackPrompt(processedData);
        break;
      case 'grade_report':
        aiPrompt = promptGenerator.generateGradePrompt(processedData);
        break;
      case 'safety_education':
        aiPrompt = promptGenerator.generateSafetyPrompt(processedData);
        break;
      case 'survey_request':
        aiPrompt = promptGenerator.generateSurveyPrompt(processedData);
        break;
      default:
        // ê¸°ë³¸ê°’: í–‰ì‚¬ ì•ˆë‚´ í˜•ì‹ ì‚¬ìš©
        aiPrompt = promptGenerator.generateEventPrompt(processedData);
        console.log('âš ï¸ ì•Œ ìˆ˜ ì—†ëŠ” ì¹´í…Œê³ ë¦¬, ê¸°ë³¸ í–‰ì‚¬ ì•ˆë‚´ í…œí”Œë¦¿ ì‚¬ìš©');
    }
    
    console.log('âœ… AI í”„ë¡¬í”„íŠ¸ ìƒì„± ì™„ë£Œ');
    console.log('ðŸ“ í”„ë¡¬í”„íŠ¸ ë¯¸ë¦¬ë³´ê¸°:', aiPrompt.substring(0, 200) + '...');
    
    // Gemini API í˜¸ì¶œ
    console.log('ðŸ¤– Gemini API í˜¸ì¶œ ì‹œìž‘');
    const result = await generateKoreanContentWithGemini(aiPrompt, apiKeyOverride);
    
    console.log('âœ… AI í†µì‹ ë¬¸ ìƒì„± ì™„ë£Œ');
    return {
      success: true,
      content: result,
      metadata: {
        category,
        schoolLevel,
        generatedAt: new Date().toISOString(),
        promptType: 'research_based_complete'
      }
    };
    
  } catch (error) {
    console.error('âŒ AI í†µì‹ ë¬¸ ìƒì„± ì‹¤íŒ¨:', error);
    return {
      success: false,
      error: error.message || 'í†µì‹ ë¬¸ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
      content: null
    };
  }
}

/**
 * ì¹´í…Œê³ ë¦¬ ëª©ë¡ ì¡°íšŒ í•¨ìˆ˜ - ì—°êµ¬ ë¬¸ì„œ ê¸°ë°˜ ë¶„ë¥˜
 */
export function getAvailableCategories() {
  return {
    'event_announcement': {
      name: 'í–‰ì‚¬ ì•ˆë‚´ (ê³µì§€ìž)',
      description: 'í•™êµ í–‰ì‚¬, ì •ì±… ë³€ê²½, ì¼ì • ê³µì§€',
      requiredFields: ['eventName', 'eventDate', 'eventLocation'],
      tone: 'ê³µì‹ì ì´ê³  ì •ë³´ì ì¸ ì–´ì¡°'
    },
    'individual_feedback': {
      name: 'ê°œë³„ í•™ìƒ í”¼ë“œë°± (í‰ê°€ìž)',
      description: 'í•™ìƒ ê°œì¸ë³„ ìƒì„¸ ê´€ì°° ë° ì„±ìž¥ í”¼ë“œë°±',
      requiredFields: ['studentName', 'observationPeriod', 'specificBehaviors'],
      tone: 'ë”°ëœ»í•˜ê³  ê°œì¸ì ì¸ ì–´ì¡°'
    },
    'grade_report': {
      name: 'ì„±ì í‘œ ë™ë´‰ íŽ¸ì§€ (í‰ê°€ìž)',
      description: 'ì„±ì í‘œì™€ í•¨ê»˜ ë°œì†¡í•˜ëŠ” ê²©ë ¤ ë©”ì‹œì§€',
      requiredFields: ['studentName', 'academicProgress'],
      tone: 'ê³µê°ì ì´ê³  ê²©ë ¤í•˜ëŠ” ì–´ì¡°'
    },
    'safety_education': {
      name: 'ì•ˆì „ êµìœ¡ (ë³´í˜¸ìž)',
      description: 'ì•ˆì „, ê±´ê°•, ìž¬ë‚œ ëŒ€ë¹„ ìˆ˜ì¹™ ì•ˆë‚´',
      requiredFields: ['safetyTopic', 'urgencyLevel'],
      tone: 'ê¸´ê¸‰í•˜ê³  ì§€ì‹œì ì¸ ì–´ì¡°'
    },
    'survey_request': {
      name: 'ì„¤ë¬¸ì¡°ì‚¬ ìš”ì²­ (ì¡°ì •ìž)',
      description: 'í•™ë¶€ëª¨ ì˜ê²¬ ìˆ˜ë ´, ë™ì˜ì„œ, ì°¸ì—¬ ìš”ì²­',
      requiredFields: ['surveyTitle', 'surveyPurpose', 'deadline'],
      tone: 'ì •ì¤‘í•˜ê³  í˜‘ì¡° ìš”ì²­í•˜ëŠ” ì–´ì¡°'
    }
  };
}

/**
 * ì‚¬ìš© ê°€ëŠ¥í•œ í•™êµê¸‰ ëª©ë¡
 */
export function getSchoolLevels() {
  return {
    'elementary': 'ì´ˆë“±í•™êµ',
    'middle': 'ì¤‘í•™êµ', 
    'high': 'ê³ ë“±í•™êµ'
  };
}

/**
 * ì•ˆì „ êµìœ¡ ì£¼ì œ ëª©ë¡
 */
export function getSafetyTopics() {
  return Object.keys(SAFETY_HEALTH_MODULES).reduce((acc, key) => {
    acc[key] = SAFETY_HEALTH_MODULES[key].title;
    return acc;
  }, {});
}

console.log('âœ… ìƒˆë¡œìš´ AI ê°€ì •í†µì‹ ë¬¸ ì„œë¹„ìŠ¤ ë¡œë“œ ì™„ë£Œ - ì—°êµ¬ ë¬¸ì„œ ê¸°ë°˜ ì™„ì „ ìž¬ì„¤ê³„');